<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Image Viewer</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body, html { margin:0; padding:0; width:100%; height:100%; background:#111; overflow:hidden; font-family:sans-serif; }
#toolbar { position:fixed; top:10px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.6); border-radius:8px; padding:6px 10px; z-index:10; }
#toolbar button { margin:0 5px; padding:6px 12px; border:none; border-radius:6px; background:#444; color:white; cursor:pointer; }
#toolbar button:hover{background:#666;}
#viewer { width:100%; height:100%; display:flex; align-items:center; justify-content:center; cursor:grab; overflow:hidden; }
#image { user-select:none; -webkit-user-drag:none; max-width:none; max-height:none; will-change:transform; }
#hint { position:fixed; bottom:14px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.55); padding:6px 10px; border-radius:999px; font-size:12px; opacity:0.9; pointer-events:none; transition:opacity 0.4s ease; }
#hint.hidden { opacity:0; }
</style>
</head>
<body>
<div id="toolbar">
<button id="fit">Fit</button>
<button id="real">100%</button>
<small>Scroll to zoom, drag to move v1.2.0</small>
</div>
<div id="viewer">
<img id="image" src="" draggable="false" ondragstart="return false;">
</div>

<script>
const viewer = document.getElementById('viewer');
const img = document.getElementById('image');
const fitBtn = document.getElementById('fit');
const realBtn = document.getElementById('real');
const hint = document.getElementById('hint');

let scale = 1, posX = 0, posY = 0, isDrag=false, lastX=0, lastY=0;
const MIN_SCALE = 0.05, MAX_SCALE = 32;

const params = new URLSearchParams(location.search);
const url = params.get('url');
if(url) img.src = url;

function updateTransform(){ img.style.transform = `translate(${posX}px,${posY}px) scale(${scale})`; }
function clamp(v,a,b){ return Math.min(b, Math.max(a,v)); }
function hideHintSoon(){ clearTimeout(hint.timer); hint.timer=setTimeout(()=>hint.classList.add('hidden'),1200); }

img.onload = () => {
  // Fit-to-window при загрузке
  const vw = viewer.clientWidth;
  const vh = viewer.clientHeight;
  scale = Math.min(vw/img.naturalWidth, vh/img.naturalHeight);
  posX = (vw - img.naturalWidth*scale)/2;
  posY = (vh - img.naturalHeight*scale)/2;
  updateTransform();
};

viewer.addEventListener('wheel', e=>{
  e.preventDefault();
  const rect = viewer.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  // координаты относительно картинки
  const imgX = (mouseX - posX)/scale;
  const imgY = (mouseY - posY)/scale;

  const factor = Math.exp(-e.deltaY*0.0015);
  const newScale = clamp(scale*factor, MIN_SCALE, MAX_SCALE);

  posX = mouseX - imgX*newScale;
  posY = mouseY - imgY*newScale;
  scale = newScale;
  updateTransform();
  hideHintSoon();
},{passive:false});

viewer.addEventListener('mousedown', e=>{
  if(e.button!==0) return;
  isDrag=true; lastX=e.clientX; lastY=e.clientY;
  viewer.style.cursor='grabbing'; hideHintSoon();
});
window.addEventListener('mousemove', e=>{
  if(!isDrag) return;
  const dx=e.clientX-lastX, dy=e.clientY-lastY;
  posX+=dx; posY+=dy;
  lastX=e.clientX; lastY=e.clientY;
  updateTransform();
});
window.addEventListener('mouseup', ()=>{
  if(!isDrag) return;
  isDrag=false;
  viewer.style.cursor='grab';
});

fitBtn.addEventListener('click', ()=>{
  const vw=viewer.clientWidth, vh=viewer.clientHeight;
  scale=Math.min(vw/img.naturalWidth, vh/img.naturalHeight);
  posX=(vw - img.naturalWidth*scale)/2;
  posY=(vh - img.naturalHeight*scale)/2;
  updateTransform();
});
realBtn.addEventListener('click', ()=>{
  scale=1;
  posX=(viewer.clientWidth - img.naturalWidth)/2;
  posY=(viewer.clientHeight - img.naturalHeight)/2;
  updateTransform();
});

window.addEvent
